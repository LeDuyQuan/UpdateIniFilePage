<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2@4.1.0-beta.1/dist/css/select2.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/angular-toastr/2.1.1/angular-toastr.css" integrity="sha512-RYarcTTv462PSTq4RPte4GvFGvEkUKl/i1+qWXbtVTnxrp/dE8fmy21y8plLaSstG2w9FVVYQUhiAgVzyimiZw==" crossorigin="anonymous" />
    <title>SDM</title>

    <link rel="stylesheet" type="text/css" href="css/util.css">
    <link rel="stylesheet" type="text/css" href="css/main.css">
</head>
<body>
    <div class="container-contact100">
        <div class="wrap-contact100">
            <form id="configForm" class="contact100-form validate-form">
                <span class="contact100-form-title">
                    Configuration
                </span>

                <div class="wrap-input100 bg1" >
                    <input id="input" class="input100" style="padding-top: 6px;" type="file">
                </div>

                <div class="wrap-input100 validate-input bg1 rs1-wrap-input100" data-validate = "Enter Camera ID">
                    <span class="label-input100">Camera id *</span>
                    <input class="input100" type="text" name="camera_id" placeholder="Enter Camera ID ">
                </div>

                <div class="wrap-input100 input100-select bg1 rs1-wrap-input100">
                    <span class="label-input100">Camera direction *</span>
                    <div>
                        <select class="js-select2" name="camera_direction">
                            <option value="IN">IN</option>
                            <option value="OUT">OUT</option>
                            <option value="COMMON">COMMON</option>
                        </select>
                        <div class="dropDownSelect2"></div>
                    </div>
                </div>

                <div class="wrap-input100 validate-input bg1" data-validate="Enter Camera URL">
                    <span class="label-input100">Camera url *</span>
                    <input class="input100" type="text" name="camera_url" placeholder="Enter Camera URL">
                </div>

                <div class="wrap-input100 validate-input bg1 rs1-wrap-input100" data-validate = "Enter Min Distance">
                    <span class="label-input100">Min distance *</span>
                    <input class="input100" type="number" name="min_distance" placeholder="Enter Min Distance ">
                </div>

                <div class="wrap-input100 validate-input bg1 rs1-wrap-input100" data-validate = "Enter Dwell Time">
                    <span class="label-input100">Dwell time *</span>
                    <input class="input100" type="number" name="dwell_time" placeholder="Enter Dwell Time ">
                </div>

                <div class="container-contact100-form-btn">
                    <button class="contact100-form-btn">
                        <span>
                            Submit
                            <i class="fa fa-long-arrow-right m-l-7" aria-hidden="true"></i>
                        </span>
                    </button>
                </div>
            </form>
        </div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js" integrity="sha512-VEd+nq25CkR676O+pLBnDW09R7VQX9Mdiij052gVCp5yVH3jGtH70Ho/UUv4mJDsEdTvqRCFZg0NKGiojGnUCw==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js"></script>
    <script>
        $(".js-select2").each(function(){
            $(this).select2({
                minimumResultsForSearch: 20,
                dropdownParent: $(this).next('.dropDownSelect2')
            });

            $(".js-select2").each(function(){
                $(this).on('select2:close', function (e){
                    if($(this).val() == "Please chooses") {
                        $('.js-show-service').slideUp();
                    }
                    else {
                        $('.js-show-service').slideUp();
                        $('.js-show-service').slideDown();
                    }
                });
            });
        })
    </script>
    <script>
        (function ($) {
            "use strict";

            /*==================================================================
            [ Validate after type ]*/
            $('.validate-input .input100').each(function(){
                $(this).on('blur', function(){
                    if(validate(this) == false){
                        showValidate(this);
                    }
                    else {
                        $(this).parent().addClass('true-validate');
                    }
                })    
            })

            /*==================================================================
            [ Validate ]*/
            var input = $('.validate-input .input100');

            $('.validate-form').on('submit',function(){
                var check = true;

                for(var i=0; i<input.length; i++) {
                    if(validate(input[i]) == false){
                        showValidate(input[i]);
                        check=false;
                    }
                }

                return check;
            });


            $('.validate-form .input100').each(function(){
                $(this).focus(function(){
                hideValidate(this);
                $(this).parent().removeClass('true-validate');
                });
            });

            function validate (input) {
                if($(input).attr('type') == 'email' || $(input).attr('name') == 'email') {
                    if($(input).val().trim().match(/^([a-zA-Z0-9_\-\.]+)@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.)|(([a-zA-Z0-9\-]+\.)+))([a-zA-Z]{1,5}|[0-9]{1,3})(\]?)$/) == null) {
                        return false;
                    }
                }
                else {
                    if($(input).val().trim() == ''){
                        return false;
                    }
                }
            }

            function showValidate(input) {
                var thisAlert = $(input).parent();

                $(thisAlert).addClass('alert-validate');

                $(thisAlert).append('<span class="btn-hide-validate">&#xf136;</span>')
                $('.btn-hide-validate').each(function(){
                    $(this).on('click',function(){
                    hideValidate(this);
                    });
                });
            }

            function hideValidate(input) {
                var thisAlert = $(input).parent();
                $(thisAlert).removeClass('alert-validate');
                $(thisAlert).find('.btn-hide-validate').remove();
            }
        })(jQuery);
	</script>
	<script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.2/dist/FileSaver.min.js"></script>

    <script >
        var objectFile = {};

        configForm.onsubmit = (e) => {
            e.preventDefault()
            const data = new FormData(document.querySelector('#configForm'));
            const cameraId = data.get('camera_id');
            const cameraDirection = data.get('camera_direction');
            const cameraUrl = data.get('camera_url');
            const minDistance = data.get('min_distance');
            const dwellTime = data.get('dwell_time');
            
            if (cameraId && cameraDirection && cameraUrl && minDistance && dwellTime) {
				console.log(cameraId, cameraDirection,cameraUrl ,minDistance,dwellTime)
				
				console.log('values',objectFile)
				var blob = new Blob(["Hello, world!"], {type: "text/plain;charset=utf-8"});
    			saveAs(blob, "confi.txt");

            } else {
                toastr['warning']('You need to fill in the necessary information!')
            }
        }

        function parseINIString(data){
            var regex = {
                section: /^\s*\[\s*([^\]]*)\s*\]\s*$/,
                param: /^\s*([^=]+?)\s*=\s*(.*?)\s*$/,
                comment: /^\s*;.*$/
            };
            var value = {};
            var lines = data.split(/[\r\n]+/);
            var section = null;
            lines.forEach(function(line, index){
                if(regex.comment.test(line)){
                    var match = line.match(regex.comment);
                    value['comment-'+index] = match[0];
                }else if(regex.param.test(line)){
                    var match = line.match(regex.param);
                    if(section){
                        value[section][match[1]] = match[2];
                    }else{
                        value[match[1]] = match[2];
                    }
                }else if(regex.section.test(line)){
                    var match = line.match(regex.section);
                    value[match[1]] = {};
                    section = match[1];
                }else if(line.length == 0 && section){
                    section = null;
                };
            });
            return value;
        }

        function loadFile() {
            const inputElement = document.getElementById("input");
            inputElement.addEventListener("change", function () {
            if (this.files && this.files[0]) {
                var myFile = this.files[0];
                var reader = new FileReader();
                reader.addEventListener('load', function (e) {
                    const values = parseINIString(e.target.result);
                    objectFile = values;
                    bindData(values);
                });
                reader.readAsBinaryString(myFile);
            }
            });
        }

        function bindData(data) {
            const setData = (prop, value) => document.forms['configForm'][prop].value = value;
            console.log(data)
            setData('camera_id', data.app?.camera_id);
            setData('camera_direction', data.app?.camera_direction);
            const cameraDirection = document.getElementsByClassName('select2-selection__rendered')[0];
            cameraDirection.innerHTML = data.app?.camera_direction;
            setData('camera_url', data.app?.camera_url);
            setData('min_distance', data.app?.min_distance);
            setData('dwell_time', data.tracking?.dwell_time);
        }

        loadFile();
    </script>
</body>
</html>
